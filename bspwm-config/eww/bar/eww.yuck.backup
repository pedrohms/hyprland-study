(deflisten active-ws `~/.config/eww/scripts/workspaces.sh`)
(deflisten wn "~/.config/eww/scripts/window-name.sh")
(defpoll wifi-icon :interval "10s" "~/.config/eww/scripts/wifi.sh icon")
(defpoll wifi-strength :interval "10s" "~/.config/eww/scripts/wifi.sh percentage")
(defpoll vol-icon :interval "1s" "~/.config/eww/scripts/volume.sh icon")
(defpoll bat-icon :interval "1m" "~/.config/eww/scripts/battery.sh icon")
(defpoll bat-lvl :interval "1m" "~/.config/eww/scripts/battery.sh level")
(defpoll volume :interval "1s" "pamixer --get-volume-human")

(defvar eww "eww -c ~/.config/eww/bar/")

(defvar wifi-rev false)
(defvar vol-rev false)
(defvar bat-rev false)

(defwidget workspaces []
  (literal :content active-ws))

(defwidget window-name []
  (literal :content wn))

(defwidget wifi []
  (eventbox
    :onhover "${eww} update wifi-rev=true"
    :onhoverlost "${eww} update wifi-rev=false"
    :class "wifi-wid"
    (box 
      :class "wifi-widget"
      :space-evenly false
      (label :class "wifi-str" :limit-width 12 :text wifi-icon)
      (revealer
        :transition "slideright"
        :reveal wifi-rev
        :duration "250ms"
        (label :orientation "h" :text wifi-strength)))))

(defwidget vol []
  (eventbox
    :onhover "${eww} update vol-rev=true"
    :onhoverlost "${eww} update vol-rev=false"
    :onclick "pamixer -t"
    (box 
      :class "vol-widget"
      :space-evenly false
      :limit-height 10
      (label :class "vol" :limit-width 12 :text vol-icon)
      (revealer
        :transition "slideright"
        :reveal vol-rev
        :duration "250ms"
        (label :orientation "h" :text volume)))))

(defwidget bat []
  (eventbox
    :onhover "${eww} update bat-rev=true"
    :onhoverlost "${eww} update bat-rev=false"
    (box 
      :class "bat-widget"
      :space-evenly false
      (button :class "bat" :limit-width 12 bat-icon)
      (revealer
        :transition "slideright"
        :reveal bat-rev
        :duration "250ms"
        (button :orientation "h" :limit-height 6 bat-lvl)))))

(defwidget side []
  (box :class "side"
       :orientation "h"
       :halign "end"
       :spacing 10
       :space-evenly false
    (wifi)
    (vol)
    (bat)))

(defwidget bar []
  (centerbox :orientation "h"
    (workspaces)
    (window-name)
    (side)))

(defwindow bar
  :stacking "fg"
  :windowtype "dock"
  :wm-ignore false
  :reserve (struts :distance "40px" :side "top")
  :geometry (geometry
              :x "0px"
              :y "0px"
              :width "100%"
              :height "36px"
              :anchor "top left")
  (bar))
